<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"><title>Arduino Car BLE Controller</title><style>:root{--bg:#f0f0f0;--text:#333;--btn-bg:#4CAF50;--btn-text:#fff;--btn-hover:#45a049;--stop-bg:#f44336;--stop-hover:#da190b;--conn-bg:#008CBA;--conn-hover:#007bb5;--status:#555;--border:#ccc;--footer:#666}body.dark-mode{--bg:#000;--text:#eee;--btn-hover:#777;--stop-bg:#880000;--stop-hover:#bb0000;--conn-bg:#005f7f;--conn-hover:#004c66;--status:#bbb;--border:#444;--footer:#4CAF50}body{font-family:'Segoe UI',sans-serif;text-align:center;margin:auto;padding:20px;background-color:var(--bg);color:var(--text);transition:all 0.3s;display:flex;flex-direction:column;min-height:100vh;justify-content:space-between;overflow:hidden;box-sizing:border-box}h1{margin-bottom:30px;font-size:1.6em}.control-panel{display:grid;grid-template-columns:repeat(3,1fr);grid-template-rows:repeat(3,auto);gap:8px;margin:10px auto;max-width:280px;width:90%}.control-panel button{width:100%;padding:12px 0;font-size:18px;border:none;border-radius:12px;cursor:pointer;transition:all 0.2s;color:var(--btn-text);background-color:var(--btn-bg);box-shadow:0 3px 6px rgba(0,0,0,0.2);-webkit-tap-highlight-color:transparent}#forwardBtn{grid-area:1/2/2/3}#leftBtn{grid-area:2/1/3/2}#stopBtn{grid-area:2/2/3/3;background-color:var(--stop-bg)}#rightBtn{grid-area:2/3/3/4}#backBtn{grid-area:3/2/4/3}#modeBtn{grid-area:4/1/5/4;margin-top:10px;background-color:#FF9800}button:active{transform:scale(0.95)}button:hover:not(#stopBtn){background-color:var(--btn-hover)}#stopBtn:hover{background-color:var(--stop-hover)}#status{margin:15px auto;padding:8px;font-size:0.9em;color:var(--status);border:1px solid var(--border);border-radius:8px;max-width:250px}#connectBtn{width:200px;height:45px;margin:15px auto;font-size:1em;background-color:var(--conn-bg);color:var(--btn-text);border:none;border-radius:8px;cursor:pointer;transition:all 0.2s;box-shadow:0 3px 6px rgba(0,0,0,0.2);display:block}#connectBtn:hover{background-color:var(--conn-hover)}#connectBtn:disabled{background-color:#a0a0a0;cursor:not-allowed}.toggle-container{margin:15px 0;display:flex;justify-content:center;align-items:center;gap:8px}.switch{position:relative;display:inline-block;width:45px;height:25px}.switch input{opacity:0;width:0;height:0}.slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:#ccc;transition:.4s;border-radius:25px}.slider:before{position:absolute;content:"";height:18px;width:18px;left:3px;bottom:3px;background-color:#fff;transition:.4s;border-radius:50%}input:checked+.slider{background-color:#2196F3}input:checked+.slider:before{transform:translateX(18px)}.footer{padding:8px;font-size:0.9em;color:var(--footer);margin-top:auto}.gamepad-controls{display:none;margin:10px 0}.gamepad-controls.active{display:block}#gamepadStatus{font-size:0.8em;margin:5px 0}</style></head><body class="dark-mode"><h1>Arduino Car BLE Controller</h1><div class="control-panel"><button id="forwardBtn">↑</button><button id="leftBtn">←</button><button id="stopBtn" onclick="sendCommand('s')">STOP</button><button id="rightBtn">→</button><button id="backBtn">↓</button><button id="modeBtn" onclick="toggleMode()">Manual Mode</button></div><button id="connectBtn" onclick="connect()">Connect to BLE</button><div id="status">Status: Disconnected</div><div class="gamepad-controls" id="gamepadControls"><div id="gamepadStatus">No gamepad detected</div><button onclick="scanGamepads()">Scan for Gamepads</button></div><div class="toggle-container"><span>Light</span><label class="switch"><input type="checkbox" id="darkModeToggle" checked><span class="slider"></span></label><span>Dark</span></div><footer class="footer"><p>Made by Giscard</p></footer><script>let characteristic,isManualMode=true,gamepadIndex=-1;const serviceUuid="4fafc201-1fb5-459e-8fcc-c5c9c331914b",characteristicUuid="beb5483e-36e1-4688-b7f5-ea07361b26a8";async function connect(){try{document.getElementById('status').textContent="Status: Connecting...";const device=await navigator.bluetooth.requestDevice({filters:[{name:"Arduino-BLE-Bridge"}],optionalServices:[serviceUuid]});const server=await device.gatt.connect(),service=await server.getPrimaryService(serviceUuid);characteristic=await service.getCharacteristic(characteristicUuid);document.getElementById('status').textContent="Status: Connected";document.getElementById('connectBtn').textContent="Connected";document.getElementById('connectBtn').disabled=true;device.addEventListener('gattserverdisconnected',()=>{document.getElementById('status').textContent="Status: Disconnected";document.getElementById('connectBtn').textContent="Connect to BLE";document.getElementById('connectBtn').disabled=false})}catch(error){console.error("BLE Connection Error:",error);document.getElementById('status').textContent=`Status: Connection failed (${error.message||error})`}}function sendCommand(command){if(!characteristic){document.getElementById('status').textContent="Status: Not connected. Please connect first.";return}const buffer=new Uint8Array([command.charCodeAt(0)]);characteristic.writeValue(buffer).catch(error=>{console.error('Error sending command:',error);document.getElementById('status').textContent="Status: Error sending command"})}function toggleMode(){isManualMode=!isManualMode;sendCommand('m');document.getElementById('modeBtn').textContent=isManualMode?"Manual Mode":"Xbox Mode";document.getElementById('gamepadControls').classList.toggle('active',!isManualMode);if(isManualMode){document.getElementById('forwardBtn').ontouchstart=document.getElementById('forwardBtn').onmousedown=()=>sendCommand('f');document.getElementById('forwardBtn').ontouchend=document.getElementById('forwardBtn').onmouseup=()=>sendCommand('s');document.getElementById('leftBtn').ontouchstart=document.getElementById('leftBtn').onmousedown=()=>sendCommand('l');document.getElementById('leftBtn').ontouchend=document.getElementById('leftBtn').onmouseup=()=>sendCommand('s');document.getElementById('rightBtn').ontouchstart=document.getElementById('rightBtn').onmousedown=()=>sendCommand('r');document.getElementById('rightBtn').ontouchend=document.getElementById('rightBtn').onmouseup=()=>sendCommand('s');document.getElementById('backBtn').ontouchstart=document.getElementById('backBtn').onmousedown=()=>sendCommand('b');document.getElementById('backBtn').ontouchend=document.getElementById('backBtn').onmouseup=()=>sendCommand('s')}else{['forwardBtn','leftBtn','rightBtn','backBtn'].forEach(id=>{const btn=document.getElementById(id);btn.ontouchstart=btn.onmousedown=btn.ontouchend=btn.onmouseup=null});startGamepadLoop()}}function scanGamepads(){const gamepads=navigator.getGamepads();for(let i=0;i<gamepads.length;i++){if(gamepads[i]){gamepadIndex=i;document.getElementById('gamepadStatus').textContent=`Gamepad connected: ${gamepads[i].id}`;return}}document.getElementById('gamepadStatus').textContent="No gamepad detected"}function startGamepadLoop(){if(isManualMode)return;const gamepad=navigator.getGamepads()[gamepadIndex];if(gamepad){const leftStickY=gamepad.axes[1],leftStickX=gamepad.axes[0];if(Math.abs(leftStickY)>0.2){const speed=Math.floor(Math.abs(leftStickY)*9);if(leftStickY<0)sendCommand(String.fromCharCode(48+speed));else sendCommand(String.fromCharCode(65+speed))}else sendCommand('s');if(Math.abs(leftStickX)>0.2){const angle=Math.floor((leftStickX+1)*4);sendCommand(String.fromCharCode(97+angle))}}requestAnimationFrame(startGamepadLoop)}window.addEventListener('gamepadconnected',e=>{gamepadIndex=e.gamepad.index;document.getElementById('gamepadStatus').textContent=`Gamepad connected: ${e.gamepad.id}`});window.addEventListener('gamepaddisconnected',()=>{gamepadIndex=-1;document.getElementById('gamepadStatus').textContent="Gamepad disconnected"});document.getElementById('darkModeToggle').addEventListener('change',e=>{document.body.classList.toggle('dark-mode',e.target.checked)});toggleMode()</script></body></html>
