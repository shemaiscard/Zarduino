
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>ESP32 BLE Car Controller</title>
  <style>
    body { font-family: sans-serif; text-align: center; margin-top: 40px; }
    button, input[type=range] { margin: 10px; font-size: 16px; padding: 10px; }
  </style>
</head>
<body>
  <h1>ESP32 BLE Car Control</h1>
  <p id="statusText">Disconnected ❌</p>
  <button onclick="connect()">Connect</button>
  <br>
  <button onclick="sendCommand('F')">Forward</button>
  <button onclick="sendCommand('B')">Backward</button><br>
  <button onclick="sendCommand('L')">Left</button>
  <button onclick="sendCommand('R')">Right</button><br>
  <label>Speed:</label>
  <input type="range" id="speedSlider" min="0" max="255" onchange="sendSpeed(this.value)">
  <script>
    const SERVICE_UUID = "6e400001-b5a3-f393-e0a9-e50e24dcca9e";
    const TX_CHARACTERISTIC_UUID = "6e400002-b5a3-f393-e0a9-e50e24dcca9e";
    let bleDevice, bleServer, bleService, bleTxCharacteristic;

    async function connect() {
      try {
        bleDevice = await navigator.bluetooth.requestDevice({
          acceptAllDevices: true,
          optionalServices: [SERVICE_UUID]
        });
        bleServer = await bleDevice.gatt.connect();
        bleService = await bleServer.getPrimaryService(SERVICE_UUID);
        bleTxCharacteristic = await bleService.getCharacteristic(TX_CHARACTERISTIC_UUID);
        document.getElementById("statusText").textContent = "Connected ✅";
      } catch (error) {
        alert("Connection failed: " + error);
      }
    }

    function sendCommand(cmd) {
      if (bleTxCharacteristic) {
        bleTxCharacteristic.writeValue(new TextEncoder().encode(cmd));
      }
    }

    function sendSpeed(value) {
      if (bleTxCharacteristic) {
        bleTxCharacteristic.writeValue(new TextEncoder().encode("S" + value));
      }
    }
  </script>
</body>
</html>
