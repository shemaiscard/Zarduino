<!DOCTYPE html>
<html>
<head>
    <title>Arduino Car BLE Controller</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; margin: 20px; }
        .control-panel { margin: 20px auto; max-width: 300px; }
        button { 
            width: 80px; height: 80px; margin: 5px; 
            font-size: 20px; border-radius: 10px;
        }
        #status { margin-top: 20px; padding: 10px; }
        #connectBtn { width: 200px; height: 50px; margin-top: 20px; }
    </style>
</head>
<body>
    <h1>Arduino Car BLE Controller</h1>
    
    <div class="control-panel">
        <button id="forwardBtn" ontouchstart="sendCommand('f')" ontouchend="sendCommand('s')" 
                onmousedown="sendCommand('f')" onmouseup="sendCommand('s')">↑</button><br>
        <button id="leftBtn" ontouchstart="sendCommand('l')" ontouchend="sendCommand('s')" 
                onmousedown="sendCommand('l')" onmouseup="sendCommand('s')">←</button>
        <button id="stopBtn" onclick="sendCommand('s')">STOP</button>
        <button id="rightBtn" ontouchstart="sendCommand('r')" ontouchend="sendCommand('s')" 
                onmousedown="sendCommand('r')" onmouseup="sendCommand('s')">→</button><br>
        <button id="backBtn" ontouchstart="sendCommand('b')" ontouchend="sendCommand('s')" 
                onmousedown="sendCommand('b')" onmouseup="sendCommand('s')">↓</button>
    </div>
    
    <button id="connectBtn" onclick="connect()">Connect to BLE</button>
    <div id="status">Status: Disconnected</div>

    <script>
        let characteristic;
        const serviceUuid = "4fafc201-1fb5-459e-8fcc-c5c9c331914b";
        const characteristicUuid = "beb5483e-36e1-4688-b7f5-ea07361b26a8";
        
        async function connect() {
            try {
                const device = await navigator.bluetooth.requestDevice({
                    filters: [{ name: "Arduino-BLE-Bridge" }],
                    optionalServices: [serviceUuid]
                });
                
                const server = await device.gatt.connect();
                const service = await server.getPrimaryService(serviceUuid);
                characteristic = await service.getCharacteristic(characteristicUuid);
                
                document.getElementById('status').textContent = "Status: Connected";
                document.getElementById('connectBtn').textContent = "Connected";
                document.getElementById('connectBtn').disabled = true;
                
                device.addEventListener('gattserverdisconnected', () => {
                    document.getElementById('status').textContent = "Status: Disconnected";
                    document.getElementById('connectBtn').textContent = "Connect to BLE";
                    document.getElementById('connectBtn').disabled = false;
                });
            } catch (error) {
                console.error(error);
                document.getElementById('status').textContent = "Status: Connection failed";
            }
        }
        
        function sendCommand(command) {
            if (!characteristic) {
                alert("Not connected to BLE!");
                return;
            }
            
            const buffer = new Uint8Array([command.charCodeAt(0)]);
            characteristic.writeValue(buffer)
                .catch(error => {
                    console.error('Error:', error);
                    document.getElementById('status').textContent = "Status: Error sending command";
                });
        }
    </script>
</body>
</html>
