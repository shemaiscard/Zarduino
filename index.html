<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>BLE Car Controller</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      margin-top: 40px;
      background-color: #f0f0f0;
    }

    button, input[type=range] {
      margin: 10px;
      padding: 15px 30px;
      font-size: 18px;
    }

    #status {
      font-weight: bold;
      margin: 15px;
    }
  </style>
</head>
<body>
  <h1>ESP32 BLE Car Control</h1>
  <div id="status">Status: <span id="statusText">Disconnected</span></div>

  <button onclick="connect()">üîå Connect</button>
  <br><br>

  <button onclick="sendCommand('F')">‚¨Ü Forward</button><br>
  <button onclick="sendCommand('L')">‚¨Ö Left</button>
  <button onclick="sendCommand('S')">‚èπ Stop</button>
  <button onclick="sendCommand('R')">‚û° Right</button><br>
  <button onclick="sendCommand('B')">‚¨á Backward</button><br>

  <script>
    let bleDevice = null;
    let bleServer = null;
    let bleService = null;
    let bleTxCharacteristic = null;

    const SERVICE_UUID = "6E400001-B5A3-F393-E0A9-E50E24DCCA9E";
    const TX_CHARACTERISTIC_UUID = "6E400002-B5A3-F393-E0A9-E50E24DCCA9E"; // RX on ESP32 side

    async function connect() {
      try {
        bleDevice = await navigator.bluetooth.requestDevice({
          filters: [{ name: 'ESP32-CAR' }],
          optionalServices: [SERVICE_UUID]
        });

        bleServer = await bleDevice.gatt.connect();
        bleService = await bleServer.getPrimaryService(SERVICE_UUID);
        bleTxCharacteristic = await bleService.getCharacteristic(TX_CHARACTERISTIC_UUID);

        document.getElementById("statusText").textContent = "Connected ‚úÖ";

      } catch (error) {
        alert("Connection failed: " + error);
      }
    }

    async function sendCommand(cmd) {
      if (!bleTxCharacteristic) {
        alert("Not connected!");
        return;
      }

      const encoder = new TextEncoder();
      await bleTxCharacteristic.writeValue(encoder.encode(cmd));
    }
  </script>
</body>
</html>
